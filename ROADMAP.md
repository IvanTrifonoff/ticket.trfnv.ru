# ROADMAP: Развитие функционала продажи билетов и рассадки Pretix

## I. Улучшение текущего функционала рассадки (Frontend & Backend)

### 1. Индикация статуса мест на схеме
*   **Цель:** Визуальное отображение занятых, забронированных и доступных мест для пользователя.
*   **Детали:**
    *   Расширить данные, передаваемые на фронтенд из `init_seating.py` (или через API), включив текущий статус каждого места (например, `available`, `taken`, `reserved`).
    *   В `seating.js` реализовать логику чтения статуса места и применять соответствующие CSS-классы к SVG-элементам мест.
    *   В `seating.css` определить стили для различных статусов мест (разные цвета, прозрачность, обводка).
    *   Реализовать обработку клика по уже выбранному месту (снятие выделения, удаление из корзины).

### 2. Улучшенная обратная связь пользователю при ошибках
*   **Цель:** Предоставлять пользователю понятные сообщения об ошибках при невозможности добавить место в корзину.
*   **Детали:**
    *   В `seating.js` улучшить парсинг ответов от Pretix при ошибках (`xhr.status >= 400`). Если Pretix возвращает JSON с деталями ошибки, отображать их.
    *   Использовать стандартные механизмы сообщений Pretix (через `messages.error` или модальные окна) для вывода ошибок типа "Место уже занято", "Квота исчерпана" и т.п.

### 3. Расширенные возможности рендеринга SVG-схем
*   **Цель:** Позволить создавать более разнообразные и детальные схемы рассадки.
*   **Детали:**
    *   Добавить в JSON-структуру схемы рассадки параметры для:
        *   Различных форм мест (круги, прямоугольники, полигоны).
        *   Произвольного размера и положения текста внутри места.
        *   Группировки мест (например, для VIP-зон).
    *   В `seating.js` расширить логику отрисовки для поддержки этих параметров.

## II. Интеграция с платежными системами РФ

### 1. Подключение российских платежных шлюзов
*   **Цель:** Обеспечить прием платежей онлайн через популярные в России сервисы.
*   **Детали:**
    *   **Исследование:** Определить наиболее подходящие платежные системы (например, ЮKassa, СберБанк, Tinkoff, CloudPayments) с учетом их API, комиссий и популярности.
    *   **Разработка плагинов:** Интегрировать выбранные шлюзы с Pretix, следуя архитектуре платежных провайдеров Pretix (создать новые плагины или адаптировать существующие).
    *   Реализовать полный цикл оплаты: инициация, подтверждение, отмена, возврат.

### 2. Соответствие 54-ФЗ (Онлайн-кассы и фискализация)
*   **Цель:** Автоматическая передача данных о платежах в налоговую службу через операторов фискальных данных (ОФД).
*   **Детали:**
    *   Интеграция с облачными сервисами онлайн-касс (например, АТОЛ Онлайн, Orange Data, СберКасса) для формирования и отправки фискальных чеков.
    *   Реализация отправки электронных чеков покупателям (по e-mail или SMS).

## III. Российская специфика и локализация

### 1. Юридическое соответствие
*   **Цель:** Обеспечить соответствие законодательству РФ.
*   **Детали:**
    *   Проверка соответствия 152-ФЗ (Закон о персональных данных): хранение данных граждан РФ на территории РФ, обновление политик конфиденциальности.
    *   Обеспечение соответствия другим применимым нормативным актам.

### 2. Налогообложение и отчетность
*   **Цель:** Корректный учет НДС и формирование отчетности.
*   **Детали:** Убедиться, что Pretix правильно настроен для расчетов и отображения цен с учетом НДС (если применимо) и может генерировать необходимую отчетность.

## IV. Улучшенный функционал администрирования рассадки

### 1. Визуальный редактор схемы рассадки в админ-панели
*   **Цель:** Предоставить администраторам удобный инструмент для создания и редактирования схем рассадки без кодирования.
*   **Детали:**
    *   Разработать или интегрировать WYSIWYG-редактор SVG-схем, который сохраняет данные в JSON-формате, совместимом с `SeatingPlan`.
    *   Интегрировать редактор в административный интерфейс Pretix (например, через кастомный виджет для поля `layout_data`).

### 2. Гибкое управление ценами и квотами для мест
*   **Цель:** Возможность устанавливать разные цены, квоты и условия для отдельных мест, рядов или зон.
*   **Детали:**
    *   Разработать интерфейс в админ-панели, позволяющий привязывать различные `Item` (товары) и `Quota` (квоты) к конкретным `Seat` или группам `Seat` (по `category`, `row_name`, `zone_name`).
    *   Расширить логику `CartManager` для учета этих специфических правил ценообразования и доступности.

## V. Производительность и масштабируемость

### 1. Оптимизация рендеринга больших схем
*   **Цель:** Поддержание высокой производительности фронтенда при работе с большими и сложными схемами рассадки.
*   **Детали:**
    *   Использование техник виртуализации или частичного рендеринга для SVG-элементов.
    *   Оптимизация JavaScript-кода для более быстрой отрисовки и реакции на действия пользователя.

### 2. Кэширование данных схемы и статусов
*   **Цель:** Снижение нагрузки на базу данных и ускорение загрузки схемы.
*   **Детали:**
    *   Реализовать кэширование JSON-данных схемы рассадки на стороне сервера (Redis).
    *   Кэширование статусов доступности мест (для снижения количества запросов к БД).

---
**Версия:** 1.0
**Дата:** 2025-12-14
**Автор:** Gemini Agent
